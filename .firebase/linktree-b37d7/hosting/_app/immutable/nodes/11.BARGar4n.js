import{s as ae,v as X,h as x,o as H,e as C,i as D,a as T,l as I,k as V,b as O,d as R,m as j,A as $,B as ue,r as ce,t as E,j as U}from"../chunks/scheduler.DfGOlq3b.js";import{S as fe,i as re,d as S,v as me,g as de,h as he,m as _e,t as pe,e as be,j as ke,c as g,a as b,b as A,f as y,l as L,s as W}from"../chunks/index.BzQEtMZ_.js";import{A as ie}from"../chunks/AuthCheck.xyOzPo3I.js";import{e as N,b as Y,u as F,f as z,j as ee,w as te}from"../chunks/firebase.C_6QoUeW.js";const ye=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,{console:ge}=ye,B="src/routes/login/username/+page.svelte";function se(i){let e,n="username",a,s,t,o,l,k,v,u,r,w,m=i[1]&&M(i),h=!i[3]&&i[5]&&Z(i),d=i[3]&&!i[2]&&!i[1]&&G(i),_=i[2]&&i[3]&&!i[1]&&J(i);const q={c:function(){e=C("h2"),e.textContent=n,a=D(),s=C("form"),t=C("input"),o=D(),l=C("div"),m&&m.c(),k=D(),h&&h.c(),v=D(),d&&d.c(),u=D(),_&&_.c(),this.h()},l:function(c){e=T(c,"H2",{"data-svelte-h":!0}),I(e)!=="svelte-hq7db6"&&(e.textContent=n),a=V(c),s=T(c,"FORM",{class:!0});var p=O(s);t=T(p,"INPUT",{type:!0,placeholder:!0,class:!0}),o=V(p),l=T(p,"DIV",{class:!0});var P=O(l);m&&m.l(P),k=V(P),h&&h.l(P),v=V(P),d&&d.l(P),u=V(P),_&&_.l(P),P.forEach(b),p.forEach(b),this.h()},h:function(){R(e,B,58,6,1421),A(t,"type","text"),A(t,"placeholder","Username"),A(t,"class","input w-full"),j(t,"input-error",!i[3]&&i[5]),j(t,"input-warning",i[4]),j(t,"input-success",!i[1]&&i[2]&&i[3]),R(t,B,60,8,1517),A(l,"class","my-4 min-h-16 px-8 w-full"),R(l,B,70,8,1859),A(s,"class","w-2/5"),R(s,B,59,6,1445)},m:function(c,p){g(c,e,p),g(c,a,p),g(c,s,p),y(s,t),$(t,i[0]),y(s,o),y(s,l),m&&m.m(l,null),y(l,k),h&&h.m(l,null),y(l,v),d&&d.m(l,null),y(l,u),_&&_.m(l,null),r||(w=[L(t,"input",i[9]),L(t,"input",i[7],!1,!1,!1,!1),L(s,"submit",ue(i[8]),!1,!0,!1,!1)],r=!0)},p:function(c,p){p&1&&t.value!==c[0]&&$(t,c[0]),p&40&&j(t,"input-error",!c[3]&&c[5]),p&16&&j(t,"input-warning",c[4]),p&14&&j(t,"input-success",!c[1]&&c[2]&&c[3]),c[1]?m||(m=M(c),m.c(),m.m(l,k)):m&&(m.d(1),m=null),!c[3]&&c[5]?h||(h=Z(c),h.c(),h.m(l,v)):h&&(h.d(1),h=null),c[3]&&!c[2]&&!c[1]?d?d.p(c,p):(d=G(c),d.c(),d.m(l,u)):d&&(d.d(1),d=null),c[2]&&c[3]&&!c[1]?_?_.p(c,p):(_=J(c),_.c(),_.m(l,null)):_&&(_.d(1),_=null)},d:function(c){c&&(b(e),b(a),b(s)),m&&m.d(),h&&h.d(),d&&d.d(),_&&_.d(),r=!1,ce(w)}};return S("SvelteRegisterBlock",{block:q,id:se.name,type:"else",source:"(49:4) {:else}",ctx:i}),q}function oe(i){let e,n=i[6].username&&K(i);const a={c:function(){n&&n.c(),e=H()},l:function(t){n&&n.l(t),e=H()},m:function(t,o){n&&n.m(t,o),g(t,e,o)},p:function(t,o){t[6].username?n?n.p(t,o):(n=K(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d:function(t){t&&b(e),n&&n.d(t)}};return S("SvelteRegisterBlock",{block:a,id:oe.name,type:"if",source:"(44:2) {#if $userData}",ctx:i}),a}function M(i){let e,n="Checking availability";const a={c:function(){e=C("p"),e.textContent=n,this.h()},l:function(t){e=T(t,"P",{class:!0,"data-svelte-h":!0}),I(e)!=="svelte-qwrxjw"&&(e.textContent=n),this.h()},h:function(){A(e,"class","text-secondary"),R(e,B,72,12,1935)},m:function(t,o){g(t,e,o)},d:function(t){t&&b(e)}};return S("SvelteRegisterBlock",{block:a,id:M.name,type:"if",source:"(63:10) {#if loading}",ctx:i}),a}function Z(i){let e,n="must be 3-16 characters long, alphanumeric only";const a={c:function(){e=C("p"),e.textContent=n,this.h()},l:function(t){e=T(t,"P",{class:!0,"data-svelte-h":!0}),I(e)!=="svelte-1suomdh"&&(e.textContent=n),this.h()},h:function(){A(e,"class","text-error text-sm"),R(e,B,75,12,2053)},m:function(t,o){g(t,e,o)},d:function(t){t&&b(e)}};return S("SvelteRegisterBlock",{block:a,id:Z.name,type:"if",source:"(66:10) {#if !isValid && isTouched}",ctx:i}),a}function G(i){let e,n,a;const s={c:function(){e=C("p"),n=E(i[0]),a=E(" is already taken"),this.h()},l:function(o){e=T(o,"P",{class:!0});var l=O(e);n=U(l,i[0]),a=U(l," is already taken"),l.forEach(b),this.h()},h:function(){A(e,"class","text-error text-sm"),R(e,B,80,12,2243)},m:function(o,l){g(o,e,l),y(e,n),y(e,a)},p:function(o,l){l&1&&W(n,o[0])},d:function(o){o&&b(e)}};return S("SvelteRegisterBlock",{block:s,id:G.name,type:"if",source:"(71:10) {#if isValid && !isAvailable && !loading}",ctx:i}),s}function J(i){let e,n,a;const s={c:function(){e=C("button"),n=E("Confirm username @"),a=E(i[0]),this.h()},l:function(o){e=T(o,"BUTTON",{class:!0});var l=O(e);n=U(l,"Confirm username @"),a=U(l,i[0]),l.forEach(b),this.h()},h:function(){A(e,"class","btn btn-success"),R(e,B,84,12,2385)},m:function(o,l){g(o,e,l),y(e,n),y(e,a)},p:function(o,l){l&1&&W(a,o[0])},d:function(o){o&&b(e)}};return S("SvelteRegisterBlock",{block:s,id:J.name,type:"if",source:"(75:10) {#if isAvailable && isValid && !loading}",ctx:i}),s}function K(i){let e,n,a=i[6].username+"",s,t,o,l="(username cannot be changed)";const k={c:function(){e=C("h3"),n=E("Your username is "),s=E(a),t=D(),o=C("p"),o.textContent=l,this.h()},l:function(u){e=T(u,"H3",{});var r=O(e);n=U(r,"Your username is "),s=U(r,a),r.forEach(b),t=V(u),o=T(u,"P",{"data-svelte-h":!0}),I(o)!=="svelte-19nzs61"&&(o.textContent=l),this.h()},h:function(){R(e,B,54,6,1302),R(o,B,55,6,1355)},m:function(u,r){g(u,e,r),y(e,n),y(e,s),g(u,t,r),g(u,o,r)},p:function(u,r){r&64&&a!==(a=u[6].username+"")&&W(s,a)},d:function(u){u&&(b(e),b(t),b(o))}};return S("SvelteRegisterBlock",{block:k,id:K.name,type:"if",source:"(45:4) {#if $userData.username}",ctx:i}),k}function le(i){let e;function n(o,l){return o[6]?oe:se}let a=n(i),s=a(i);const t={c:function(){s.c(),e=H()},l:function(l){s.l(l),e=H()},m:function(l,k){s.m(l,k),g(l,e,k)},p:function(l,k){a===(a=n(l))&&s?s.p(l,k):(s.d(1),s=a(l),s&&(s.c(),s.m(e.parentNode,e)))},d:function(l){l&&b(e),s.d(l)}};return S("SvelteRegisterBlock",{block:t,id:le.name,type:"slot",source:"(43:0) <AuthCheck>",ctx:i}),t}function Q(i){let e,n;e=new ie({props:{$$slots:{default:[le]},$$scope:{ctx:i}},$$inline:!0});const a={c:function(){de(e.$$.fragment)},l:function(t){he(e.$$.fragment,t)},m:function(t,o){_e(e,t,o),n=!0},p:function(t,[o]){const l={};o&4223&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i:function(t){n||(pe(e.$$.fragment,t),n=!0)},o:function(t){be(e.$$.fragment,t),n=!1},d:function(t){ke(e,t)}};return S("SvelteRegisterBlock",{block:a,id:Q.name,type:"component",source:"",ctx:i}),a}const ne=/^(?=[a-zA-Z0-9._]{3,16}$)(?!.*[_.]{2})[^_.].*[^_.]$/;function ve(i,e,n){let a,s,t,o,l;X(Y,"user"),x(i,Y,f=>n(11,o=f)),X(F,"userData"),x(i,F,f=>n(6,l=f));let{$$slots:k={},$$scope:v}=e;me("Page",k,[]);let u="",r=!1,w=!1,m;async function h(){clearTimeout(m),n(2,w=!1),n(1,r=!0),m=setTimeout(async()=>{const f=z(N,"usernames",u),c=ee(f).then(p=>n(2,w=!p.exists()));console.log(c),n(2,w=!c),n(1,r=!1)},500)}async function d(){const f=te(N);f.set(z(N,"usernames",u),{uid:o==null?void 0:o.uid}),f.set(z(N,"users",o.uid),{username:u,PhotoURL:(o==null?void 0:o.photoURL)??null,published:!0,bio:"",links:[]}),await f.commit(),n(0,u=""),n(2,w=!1)}const _=[];Object.keys(e).forEach(f=>{!~_.indexOf(f)&&f.slice(0,2)!=="$$"&&f!=="slot"&&ge.warn(`<Page> was created with unknown prop '${f}'`)});function q(){u=this.value,n(0,u)}return i.$capture_state=()=>({AuthCheck:ie,db:N,user:Y,userData:F,doc:z,getDoc:ee,writeBatch:te,username:u,loading:r,isAvailable:w,debounceTimer:m,checkAvailability:h,confirmUsername:d,re:ne,isValid:a,isTaken:t,isTouched:s,$user:o,$userData:l}),i.$inject_state=f=>{"username"in f&&n(0,u=f.username),"loading"in f&&n(1,r=f.loading),"isAvailable"in f&&n(2,w=f.isAvailable),"debounceTimer"in f&&(m=f.debounceTimer),"isValid"in f&&n(3,a=f.isValid),"isTaken"in f&&n(4,t=f.isTaken),"isTouched"in f&&n(5,s=f.isTouched)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),i.$$.update=()=>{i.$$.dirty&1&&n(3,a=(u==null?void 0:u.length)>2&&(u==null?void 0:u.length)<16&&ne.test(u)),i.$$.dirty&1&&n(5,s=(u==null?void 0:u.length)>0),i.$$.dirty&14&&n(4,t=a&&!w&&!r)},[u,r,w,a,t,s,l,h,d,q]}class Be extends fe{constructor(e){super(e),re(this,e,ve,Q,ae,{}),S("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:Q.name})}}export{Be as component};
